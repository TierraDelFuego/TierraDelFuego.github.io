
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Cppcheck - HTML report - [project name]</title>
    <link rel="stylesheet" href="style.css">
    <style>
.highlight .hll { background-color: #ffffcc }
.highlight  { background: #ffffff; }
.highlight .c { color: #888888 } /* Comment */
.highlight .err { color: #FF0000; background-color: #FFAAAA } /* Error */
.highlight .k { color: #008800; font-weight: bold } /* Keyword */
.highlight .o { color: #333333 } /* Operator */
.highlight .cm { color: #888888 } /* Comment.Multiline */
.highlight .cp { color: #557799 } /* Comment.Preproc */
.highlight .c1 { color: #888888 } /* Comment.Single */
.highlight .cs { color: #cc0000; font-weight: bold } /* Comment.Special */
.highlight .gd { color: #A00000 } /* Generic.Deleted */
.highlight .ge { font-style: italic } /* Generic.Emph */
.highlight .gr { color: #FF0000 } /* Generic.Error */
.highlight .gh { color: #000080; font-weight: bold } /* Generic.Heading */
.highlight .gi { color: #00A000 } /* Generic.Inserted */
.highlight .go { color: #888888 } /* Generic.Output */
.highlight .gp { color: #c65d09; font-weight: bold } /* Generic.Prompt */
.highlight .gs { font-weight: bold } /* Generic.Strong */
.highlight .gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.highlight .gt { color: #0044DD } /* Generic.Traceback */
.highlight .kc { color: #008800; font-weight: bold } /* Keyword.Constant */
.highlight .kd { color: #008800; font-weight: bold } /* Keyword.Declaration */
.highlight .kn { color: #008800; font-weight: bold } /* Keyword.Namespace */
.highlight .kp { color: #003388; font-weight: bold } /* Keyword.Pseudo */
.highlight .kr { color: #008800; font-weight: bold } /* Keyword.Reserved */
.highlight .kt { color: #333399; font-weight: bold } /* Keyword.Type */
.highlight .m { color: #6600EE; font-weight: bold } /* Literal.Number */
.highlight .s { background-color: #fff0f0 } /* Literal.String */
.highlight .na { color: #0000CC } /* Name.Attribute */
.highlight .nb { color: #007020 } /* Name.Builtin */
.highlight .nc { color: #BB0066; font-weight: bold } /* Name.Class */
.highlight .no { color: #003366; font-weight: bold } /* Name.Constant */
.highlight .nd { color: #555555; font-weight: bold } /* Name.Decorator */
.highlight .ni { color: #880000; font-weight: bold } /* Name.Entity */
.highlight .ne { color: #FF0000; font-weight: bold } /* Name.Exception */
.highlight .nf { color: #0066BB; font-weight: bold } /* Name.Function */
.highlight .nl { color: #997700; font-weight: bold } /* Name.Label */
.highlight .nn { color: #0e84b5; font-weight: bold } /* Name.Namespace */
.highlight .nt { color: #007700 } /* Name.Tag */
.highlight .nv { color: #996633 } /* Name.Variable */
.highlight .ow { color: #000000; font-weight: bold } /* Operator.Word */
.highlight .w { color: #bbbbbb } /* Text.Whitespace */
.highlight .mb { color: #6600EE; font-weight: bold } /* Literal.Number.Bin */
.highlight .mf { color: #6600EE; font-weight: bold } /* Literal.Number.Float */
.highlight .mh { color: #005588; font-weight: bold } /* Literal.Number.Hex */
.highlight .mi { color: #0000DD; font-weight: bold } /* Literal.Number.Integer */
.highlight .mo { color: #4400EE; font-weight: bold } /* Literal.Number.Oct */
.highlight .sb { background-color: #fff0f0 } /* Literal.String.Backtick */
.highlight .sc { color: #0044DD } /* Literal.String.Char */
.highlight .sd { color: #DD4422 } /* Literal.String.Doc */
.highlight .s2 { background-color: #fff0f0 } /* Literal.String.Double */
.highlight .se { color: #666666; font-weight: bold; background-color: #fff0f0 } /* Literal.String.Escape */
.highlight .sh { background-color: #fff0f0 } /* Literal.String.Heredoc */
.highlight .si { background-color: #eeeeee } /* Literal.String.Interpol */
.highlight .sx { color: #DD2200; background-color: #fff0f0 } /* Literal.String.Other */
.highlight .sr { color: #000000; background-color: #fff0ff } /* Literal.String.Regex */
.highlight .s1 { background-color: #fff0f0 } /* Literal.String.Single */
.highlight .ss { color: #AA6600 } /* Literal.String.Symbol */
.highlight .bp { color: #007020 } /* Name.Builtin.Pseudo */
.highlight .vc { color: #336699 } /* Name.Variable.Class */
.highlight .vg { color: #dd7700; font-weight: bold } /* Name.Variable.Global */
.highlight .vi { color: #3333BB } /* Name.Variable.Instance */
.highlight .il { color: #0000DD; font-weight: bold } /* Literal.Number.Integer.Long */
    </style>
    <script language="javascript">
      function getStyle(el,styleProp) {
        if (el.currentStyle)
          var y = el.currentStyle[styleProp];
        else if (window.getComputedStyle)
          var y = document.defaultView.getComputedStyle(el,null).getPropertyValue(styleProp);
        return y;
      }
      function toggle() {
        var el = this.expandable_content;
        var mark = this.expandable_marker;
        if (el.style.display == "block") {
          el.style.display = "none";
          mark.innerHTML = "[+]";
        } else {
          el.style.display = "block";
          mark.innerHTML = "[-]";
        }
      }
      function init_expandables() {
        var elts = document.getElementsByClassName("expandable");
        for (var i = 0; i < elts.length; i++) {
          var el = elts[i];
          var clickable = el.getElementsByTagName("span")[0];
          var marker = clickable.getElementsByClassName("marker")[0];
          var content = el.getElementsByClassName("content")[0];
          var width = clickable.clientWidth - parseInt(getStyle(content, "padding-left")) - parseInt(getStyle(content, "padding-right"));
          content.style.width = width + "px";
          clickable.expandable_content = content;
          clickable.expandable_marker = marker;
          clickable.onclick = toggle;
        }
      }
    </script>
  </head>
  <body onload="init_expandables()">
      <div id="header">
        <h1>Cppcheck report - [project name]: ../../godot/drivers/png/pngwio.c </h1>
      </div>
      <div id="menu" dir="rtl">
       <p id="filename"><a href="index.html">Defects:</a> pngwio.c</p>
<a href='458.html#line-1'> ConfigurationNotChecked 1</a><a href='458.html#line-94'> variableScope 94</a><a href='458.html#line-94'> variableScope 94</a>
      </div>
      <div id="content">
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253</pre></div></td><td class="code"><div class="highlight"><pre><a name="line-1"></a><span class="hll"><span class="cm">/* pngwio.c - functions for data output</span><span class='error2'>&lt;--- Skipping configuration 'PNG_EXPORT_LAST_ORDINAL' since the value of 'PNG_EXPORT_LAST_ORDINAL' is unknown. Use -D if you want to check it. You can use -U to skip it explicitly.</span>
</span><a name="line-2"></a><span class="cm"> *</span>
<a name="line-3"></a><span class="cm"> * Last changed in libpng 1.5.0 [January 6, 2011]</span>
<a name="line-4"></a><span class="cm"> * Copyright (c) 1998-2011 Glenn Randers-Pehrson</span>
<a name="line-5"></a><span class="cm"> * (Version 0.96 Copyright (c) 1996, 1997 Andreas Dilger)</span>
<a name="line-6"></a><span class="cm"> * (Version 0.88 Copyright (c) 1995, 1996 Guy Eric Schalnat, Group 42, Inc.)</span>
<a name="line-7"></a><span class="cm"> *</span>
<a name="line-8"></a><span class="cm"> * This code is released under the libpng license.</span>
<a name="line-9"></a><span class="cm"> * For conditions of distribution and use, see the disclaimer</span>
<a name="line-10"></a><span class="cm"> * and license in png.h</span>
<a name="line-11"></a><span class="cm"> *</span>
<a name="line-12"></a><span class="cm"> * This file provides a location for all output.  Users who need</span>
<a name="line-13"></a><span class="cm"> * special handling are expected to write functions that have the same</span>
<a name="line-14"></a><span class="cm"> * arguments as these and perform similar functions, but that possibly</span>
<a name="line-15"></a><span class="cm"> * use different output methods.  Note that you shouldn&#39;t change these</span>
<a name="line-16"></a><span class="cm"> * functions, but rather write replacement functions and then change</span>
<a name="line-17"></a><span class="cm"> * them at run time with png_set_write_fn(...).</span>
<a name="line-18"></a><span class="cm"> */</span>
<a name="line-19"></a>
<a name="line-20"></a><span class="cp">#include &quot;pngpriv.h&quot;</span>
<a name="line-21"></a>
<a name="line-22"></a><span class="cp">#ifdef PNG_WRITE_SUPPORTED</span>
<a name="line-23"></a>
<a name="line-24"></a><span class="cm">/* Write the data to whatever output you are using.  The default routine</span>
<a name="line-25"></a><span class="cm"> * writes to a file pointer.  Note that this routine sometimes gets called</span>
<a name="line-26"></a><span class="cm"> * with very small lengths, so you should implement some kind of simple</span>
<a name="line-27"></a><span class="cm"> * buffering if you are using unbuffered writes.  This should never be asked</span>
<a name="line-28"></a><span class="cm"> * to write more than 64K on a 16 bit machine.</span>
<a name="line-29"></a><span class="cm"> */</span>
<a name="line-30"></a>
<a name="line-31"></a><span class="kt">void</span> <span class="cm">/* PRIVATE */</span>
<a name="line-32"></a><span class="n">png_write_data</span><span class="p">(</span><span class="n">png_structp</span> <span class="n">png_ptr</span><span class="p">,</span> <span class="n">png_const_bytep</span> <span class="n">data</span><span class="p">,</span> <span class="kt">png_size_t</span> <span class="n">length</span><span class="p">)</span>
<a name="line-33"></a><span class="p">{</span>
<a name="line-34"></a>   <span class="cm">/* NOTE: write_data_fn must not change the buffer! */</span>
<a name="line-35"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">png_ptr</span><span class="o">-&gt;</span><span class="n">write_data_fn</span> <span class="o">!=</span> <span class="nb">NULL</span> <span class="p">)</span>
<a name="line-36"></a>      <span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="n">png_ptr</span><span class="o">-&gt;</span><span class="n">write_data_fn</span><span class="p">))(</span><span class="n">png_ptr</span><span class="p">,</span> <span class="p">(</span><span class="n">png_bytep</span><span class="p">)</span><span class="n">data</span><span class="p">,</span> <span class="n">length</span><span class="p">);</span>
<a name="line-37"></a>
<a name="line-38"></a>   <span class="k">else</span>
<a name="line-39"></a>      <span class="nf">png_error</span><span class="p">(</span><span class="n">png_ptr</span><span class="p">,</span> <span class="s">&quot;Call to NULL write function&quot;</span><span class="p">);</span>
<a name="line-40"></a><span class="p">}</span>
<a name="line-41"></a>
<a name="line-42"></a><span class="cp">#ifdef PNG_STDIO_SUPPORTED</span>
<a name="line-43"></a><span class="cm">/* This is the function that does the actual writing of data.  If you are</span>
<a name="line-44"></a><span class="cm"> * not writing to a standard C stream, you should create a replacement</span>
<a name="line-45"></a><span class="cm"> * write_data function and use it at run time with png_set_write_fn(), rather</span>
<a name="line-46"></a><span class="cm"> * than changing the library.</span>
<a name="line-47"></a><span class="cm"> */</span>
<a name="line-48"></a><span class="cp">#ifndef USE_FAR_KEYWORD</span>
<a name="line-49"></a><span class="kt">void</span> <span class="n">PNGCBAPI</span>
<a name="line-50"></a><span class="n">png_default_write_data</span><span class="p">(</span><span class="n">png_structp</span> <span class="n">png_ptr</span><span class="p">,</span> <span class="n">png_bytep</span> <span class="n">data</span><span class="p">,</span> <span class="kt">png_size_t</span> <span class="n">length</span><span class="p">)</span>
<a name="line-51"></a><span class="p">{</span>
<a name="line-52"></a>   <span class="kt">png_size_t</span> <span class="n">check</span><span class="p">;</span>
<a name="line-53"></a>
<a name="line-54"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">png_ptr</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
<a name="line-55"></a>      <span class="k">return</span><span class="p">;</span>
<a name="line-56"></a>
<a name="line-57"></a>   <span class="n">check</span> <span class="o">=</span> <span class="n">fwrite</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">length</span><span class="p">,</span> <span class="p">(</span><span class="n">png_FILE_p</span><span class="p">)(</span><span class="n">png_ptr</span><span class="o">-&gt;</span><span class="n">io_ptr</span><span class="p">));</span>
<a name="line-58"></a>
<a name="line-59"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">check</span> <span class="o">!=</span> <span class="n">length</span><span class="p">)</span>
<a name="line-60"></a>      <span class="n">png_error</span><span class="p">(</span><span class="n">png_ptr</span><span class="p">,</span> <span class="s">&quot;Write Error&quot;</span><span class="p">);</span>
<a name="line-61"></a><span class="p">}</span>
<a name="line-62"></a><span class="cp">#else</span>
<a name="line-63"></a><span class="cm">/* This is the model-independent version. Since the standard I/O library</span>
<a name="line-64"></a><span class="cm"> * can&#39;t handle far buffers in the medium and small models, we have to copy</span>
<a name="line-65"></a><span class="cm"> * the data.</span>
<a name="line-66"></a><span class="cm"> */</span>
<a name="line-67"></a>
<a name="line-68"></a><span class="cp">#define NEAR_BUF_SIZE 1024</span>
<a name="line-69"></a><span class="cp">#define MIN(a,b) (a &lt;= b ? a : b)</span>
<a name="line-70"></a>
<a name="line-71"></a><span class="kt">void</span> <span class="n">PNGCBAPI</span>
<a name="line-72"></a><span class="n">png_default_write_data</span><span class="p">(</span><span class="n">png_structp</span> <span class="n">png_ptr</span><span class="p">,</span> <span class="n">png_bytep</span> <span class="n">data</span><span class="p">,</span> <span class="kt">png_size_t</span> <span class="n">length</span><span class="p">)</span>
<a name="line-73"></a><span class="p">{</span>
<a name="line-74"></a>   <span class="n">png_uint_32</span> <span class="n">check</span><span class="p">;</span>
<a name="line-75"></a>   <span class="n">png_byte</span> <span class="o">*</span><span class="n">near_data</span><span class="p">;</span>  <span class="cm">/* Needs to be &quot;png_byte *&quot; instead of &quot;png_bytep&quot; */</span>
<a name="line-76"></a>   <span class="n">png_FILE_p</span> <span class="n">io_ptr</span><span class="p">;</span>
<a name="line-77"></a>
<a name="line-78"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">png_ptr</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
<a name="line-79"></a>      <span class="k">return</span><span class="p">;</span>
<a name="line-80"></a>
<a name="line-81"></a>   <span class="cm">/* Check if data really is near. If so, use usual code. */</span>
<a name="line-82"></a>   <span class="n">near_data</span> <span class="o">=</span> <span class="p">(</span><span class="n">png_byte</span> <span class="o">*</span><span class="p">)</span><span class="n">CVT_PTR_NOCHECK</span><span class="p">(</span><span class="n">data</span><span class="p">);</span>
<a name="line-83"></a>   <span class="n">io_ptr</span> <span class="o">=</span> <span class="p">(</span><span class="n">png_FILE_p</span><span class="p">)</span><span class="n">CVT_PTR</span><span class="p">(</span><span class="n">png_ptr</span><span class="o">-&gt;</span><span class="n">io_ptr</span><span class="p">);</span>
<a name="line-84"></a>
<a name="line-85"></a>   <span class="k">if</span> <span class="p">((</span><span class="n">png_bytep</span><span class="p">)</span><span class="n">near_data</span> <span class="o">==</span> <span class="n">data</span><span class="p">)</span>
<a name="line-86"></a>   <span class="p">{</span>
<a name="line-87"></a>      <span class="n">check</span> <span class="o">=</span> <span class="n">fwrite</span><span class="p">(</span><span class="n">near_data</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">length</span><span class="p">,</span> <span class="n">io_ptr</span><span class="p">);</span>
<a name="line-88"></a>   <span class="p">}</span>
<a name="line-89"></a>
<a name="line-90"></a>   <span class="k">else</span>
<a name="line-91"></a>   <span class="p">{</span>
<a name="line-92"></a>      <span class="n">png_byte</span> <span class="n">buf</span><span class="p">[</span><span class="n">NEAR_BUF_SIZE</span><span class="p">];</span>
<a name="line-93"></a>      <span class="kt">png_size_t</span> <span class="n">written</span><span class="p">,</span> <span class="n">remaining</span><span class="p">,</span> <span class="n">err</span><span class="p">;</span>
<a name="line-94"></a><span class="hll">      <span class="n">check</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span><div class='verbose expandable'><span class='error2'>&lt;--- The scope of the variable 'written' can be reduced. <span class='marker'>[+]</span></span><div class='content'>The scope of the variable &apos;written&apos; can be reduced. Warning: Be careful when fixing this message, especially when there are inner loops. Here is an example where cppcheck will write that the scope for &apos;i&apos; can be reduced:
void f(int x)
{
    int i = 0;
    if (x) {
        // it&apos;s safe to move &apos;int i = 0;&apos; here
        for (int n = 0; n &lt; 10; ++n) {
            // it is possible but not safe to move &apos;int i = 0;&apos; here
            do_something(&amp;i);
        }
    }
}
When you see this message it is always safe to reduce the variable scope 1 level.</div></div><div class='verbose expandable'><span class='error2'>&lt;--- The scope of the variable 'err' can be reduced. <span class='marker'>[+]</span></span><div class='content'>The scope of the variable &apos;err&apos; can be reduced. Warning: Be careful when fixing this message, especially when there are inner loops. Here is an example where cppcheck will write that the scope for &apos;i&apos; can be reduced:
void f(int x)
{
    int i = 0;
    if (x) {
        // it&apos;s safe to move &apos;int i = 0;&apos; here
        for (int n = 0; n &lt; 10; ++n) {
            // it is possible but not safe to move &apos;int i = 0;&apos; here
            do_something(&amp;i);
        }
    }
}
When you see this message it is always safe to reduce the variable scope 1 level.</div></div>
</span><a name="line-95"></a>      <span class="n">remaining</span> <span class="o">=</span> <span class="n">length</span><span class="p">;</span>
<a name="line-96"></a>
<a name="line-97"></a>      <span class="k">do</span>
<a name="line-98"></a>      <span class="p">{</span>
<a name="line-99"></a>         <span class="n">written</span> <span class="o">=</span> <span class="n">MIN</span><span class="p">(</span><span class="n">NEAR_BUF_SIZE</span><span class="p">,</span> <span class="n">remaining</span><span class="p">);</span>
<a name="line-100"></a>         <span class="n">png_memcpy</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">written</span><span class="p">);</span> <span class="cm">/* Copy far buffer to near buffer */</span>
<a name="line-101"></a>         <span class="n">err</span> <span class="o">=</span> <span class="n">fwrite</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">written</span><span class="p">,</span> <span class="n">io_ptr</span><span class="p">);</span>
<a name="line-102"></a>
<a name="line-103"></a>         <span class="k">if</span> <span class="p">(</span><span class="n">err</span> <span class="o">!=</span> <span class="n">written</span><span class="p">)</span>
<a name="line-104"></a>            <span class="k">break</span><span class="p">;</span>
<a name="line-105"></a>
<a name="line-106"></a>         <span class="k">else</span>
<a name="line-107"></a>            <span class="n">check</span> <span class="o">+=</span> <span class="n">err</span><span class="p">;</span>
<a name="line-108"></a>
<a name="line-109"></a>         <span class="n">data</span> <span class="o">+=</span> <span class="n">written</span><span class="p">;</span>
<a name="line-110"></a>         <span class="n">remaining</span> <span class="o">-=</span> <span class="n">written</span><span class="p">;</span>
<a name="line-111"></a>      <span class="p">}</span>
<a name="line-112"></a>      <span class="k">while</span> <span class="p">(</span><span class="n">remaining</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">);</span>
<a name="line-113"></a>   <span class="p">}</span>
<a name="line-114"></a>
<a name="line-115"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">check</span> <span class="o">!=</span> <span class="n">length</span><span class="p">)</span>
<a name="line-116"></a>      <span class="n">png_error</span><span class="p">(</span><span class="n">png_ptr</span><span class="p">,</span> <span class="s">&quot;Write Error&quot;</span><span class="p">);</span>
<a name="line-117"></a><span class="p">}</span>
<a name="line-118"></a>
<a name="line-119"></a><span class="cp">#endif</span>
<a name="line-120"></a><span class="cp">#endif</span>
<a name="line-121"></a>
<a name="line-122"></a><span class="cm">/* This function is called to output any data pending writing (normally</span>
<a name="line-123"></a><span class="cm"> * to disk).  After png_flush is called, there should be no data pending</span>
<a name="line-124"></a><span class="cm"> * writing in any buffers.</span>
<a name="line-125"></a><span class="cm"> */</span>
<a name="line-126"></a><span class="cp">#ifdef PNG_WRITE_FLUSH_SUPPORTED</span>
<a name="line-127"></a><span class="kt">void</span> <span class="cm">/* PRIVATE */</span>
<a name="line-128"></a><span class="n">png_flush</span><span class="p">(</span><span class="n">png_structp</span> <span class="n">png_ptr</span><span class="p">)</span>
<a name="line-129"></a><span class="p">{</span>
<a name="line-130"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">png_ptr</span><span class="o">-&gt;</span><span class="n">output_flush_fn</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span>
<a name="line-131"></a>      <span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="n">png_ptr</span><span class="o">-&gt;</span><span class="n">output_flush_fn</span><span class="p">))(</span><span class="n">png_ptr</span><span class="p">);</span>
<a name="line-132"></a><span class="p">}</span>
<a name="line-133"></a>
<a name="line-134"></a><span class="cp">#  ifdef PNG_STDIO_SUPPORTED</span>
<a name="line-135"></a><span class="kt">void</span> <span class="n">PNGCBAPI</span>
<a name="line-136"></a><span class="n">png_default_flush</span><span class="p">(</span><span class="n">png_structp</span> <span class="n">png_ptr</span><span class="p">)</span>
<a name="line-137"></a><span class="p">{</span>
<a name="line-138"></a>   <span class="n">png_FILE_p</span> <span class="n">io_ptr</span><span class="p">;</span>
<a name="line-139"></a>
<a name="line-140"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">png_ptr</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
<a name="line-141"></a>      <span class="k">return</span><span class="p">;</span>
<a name="line-142"></a>
<a name="line-143"></a>   <span class="n">io_ptr</span> <span class="o">=</span> <span class="p">(</span><span class="n">png_FILE_p</span><span class="p">)</span><span class="n">CVT_PTR</span><span class="p">((</span><span class="n">png_ptr</span><span class="o">-&gt;</span><span class="n">io_ptr</span><span class="p">));</span>
<a name="line-144"></a>   <span class="n">fflush</span><span class="p">(</span><span class="n">io_ptr</span><span class="p">);</span>
<a name="line-145"></a><span class="p">}</span>
<a name="line-146"></a><span class="cp">#  endif</span>
<a name="line-147"></a><span class="cp">#endif</span>
<a name="line-148"></a>
<a name="line-149"></a><span class="cm">/* This function allows the application to supply new output functions for</span>
<a name="line-150"></a><span class="cm"> * libpng if standard C streams aren&#39;t being used.</span>
<a name="line-151"></a><span class="cm"> *</span>
<a name="line-152"></a><span class="cm"> * This function takes as its arguments:</span>
<a name="line-153"></a><span class="cm"> * png_ptr       - pointer to a png output data structure</span>
<a name="line-154"></a><span class="cm"> * io_ptr        - pointer to user supplied structure containing info about</span>
<a name="line-155"></a><span class="cm"> *                 the output functions.  May be NULL.</span>
<a name="line-156"></a><span class="cm"> * write_data_fn - pointer to a new output function that takes as its</span>
<a name="line-157"></a><span class="cm"> *                 arguments a pointer to a png_struct, a pointer to</span>
<a name="line-158"></a><span class="cm"> *                 data to be written, and a 32-bit unsigned int that is</span>
<a name="line-159"></a><span class="cm"> *                 the number of bytes to be written.  The new write</span>
<a name="line-160"></a><span class="cm"> *                 function should call png_error(png_ptr, &quot;Error msg&quot;)</span>
<a name="line-161"></a><span class="cm"> *                 to exit and output any fatal error messages.  May be</span>
<a name="line-162"></a><span class="cm"> *                 NULL, in which case libpng&#39;s default function will</span>
<a name="line-163"></a><span class="cm"> *                 be used.</span>
<a name="line-164"></a><span class="cm"> * flush_data_fn - pointer to a new flush function that takes as its</span>
<a name="line-165"></a><span class="cm"> *                 arguments a pointer to a png_struct.  After a call to</span>
<a name="line-166"></a><span class="cm"> *                 the flush function, there should be no data in any buffers</span>
<a name="line-167"></a><span class="cm"> *                 or pending transmission.  If the output method doesn&#39;t do</span>
<a name="line-168"></a><span class="cm"> *                 any buffering of output, a function prototype must still be</span>
<a name="line-169"></a><span class="cm"> *                 supplied although it doesn&#39;t have to do anything.  If</span>
<a name="line-170"></a><span class="cm"> *                 PNG_WRITE_FLUSH_SUPPORTED is not defined at libpng compile</span>
<a name="line-171"></a><span class="cm"> *                 time, output_flush_fn will be ignored, although it must be</span>
<a name="line-172"></a><span class="cm"> *                 supplied for compatibility.  May be NULL, in which case</span>
<a name="line-173"></a><span class="cm"> *                 libpng&#39;s default function will be used, if</span>
<a name="line-174"></a><span class="cm"> *                 PNG_WRITE_FLUSH_SUPPORTED is defined.  This is not</span>
<a name="line-175"></a><span class="cm"> *                 a good idea if io_ptr does not point to a standard</span>
<a name="line-176"></a><span class="cm"> *                 *FILE structure.</span>
<a name="line-177"></a><span class="cm"> */</span>
<a name="line-178"></a><span class="kt">void</span> <span class="n">PNGAPI</span>
<a name="line-179"></a><span class="n">png_set_write_fn</span><span class="p">(</span><span class="n">png_structp</span> <span class="n">png_ptr</span><span class="p">,</span> <span class="n">png_voidp</span> <span class="n">io_ptr</span><span class="p">,</span>
<a name="line-180"></a>    <span class="n">png_rw_ptr</span> <span class="n">write_data_fn</span><span class="p">,</span> <span class="n">png_flush_ptr</span> <span class="n">output_flush_fn</span><span class="p">)</span>
<a name="line-181"></a><span class="p">{</span>
<a name="line-182"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">png_ptr</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
<a name="line-183"></a>      <span class="k">return</span><span class="p">;</span>
<a name="line-184"></a>
<a name="line-185"></a>   <span class="n">png_ptr</span><span class="o">-&gt;</span><span class="n">io_ptr</span> <span class="o">=</span> <span class="n">io_ptr</span><span class="p">;</span>
<a name="line-186"></a>
<a name="line-187"></a><span class="cp">#ifdef PNG_STDIO_SUPPORTED</span>
<a name="line-188"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">write_data_fn</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span>
<a name="line-189"></a>      <span class="n">png_ptr</span><span class="o">-&gt;</span><span class="n">write_data_fn</span> <span class="o">=</span> <span class="n">write_data_fn</span><span class="p">;</span>
<a name="line-190"></a>
<a name="line-191"></a>   <span class="k">else</span>
<a name="line-192"></a>      <span class="n">png_ptr</span><span class="o">-&gt;</span><span class="n">write_data_fn</span> <span class="o">=</span> <span class="n">png_default_write_data</span><span class="p">;</span>
<a name="line-193"></a><span class="cp">#else</span>
<a name="line-194"></a>   <span class="n">png_ptr</span><span class="o">-&gt;</span><span class="n">write_data_fn</span> <span class="o">=</span> <span class="n">write_data_fn</span><span class="p">;</span>
<a name="line-195"></a><span class="cp">#endif</span>
<a name="line-196"></a>
<a name="line-197"></a><span class="cp">#ifdef PNG_WRITE_FLUSH_SUPPORTED</span>
<a name="line-198"></a><span class="cp">#  ifdef PNG_STDIO_SUPPORTED</span>
<a name="line-199"></a>
<a name="line-200"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">output_flush_fn</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span>
<a name="line-201"></a>      <span class="n">png_ptr</span><span class="o">-&gt;</span><span class="n">output_flush_fn</span> <span class="o">=</span> <span class="n">output_flush_fn</span><span class="p">;</span>
<a name="line-202"></a>
<a name="line-203"></a>   <span class="k">else</span>
<a name="line-204"></a>      <span class="n">png_ptr</span><span class="o">-&gt;</span><span class="n">output_flush_fn</span> <span class="o">=</span> <span class="n">png_default_flush</span><span class="p">;</span>
<a name="line-205"></a>
<a name="line-206"></a><span class="cp">#  else</span>
<a name="line-207"></a>   <span class="n">png_ptr</span><span class="o">-&gt;</span><span class="n">output_flush_fn</span> <span class="o">=</span> <span class="n">output_flush_fn</span><span class="p">;</span>
<a name="line-208"></a><span class="cp">#  endif</span>
<a name="line-209"></a><span class="cp">#endif </span><span class="cm">/* PNG_WRITE_FLUSH_SUPPORTED */</span><span class="cp"></span>
<a name="line-210"></a>
<a name="line-211"></a>   <span class="cm">/* It is an error to read while writing a png file */</span>
<a name="line-212"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">png_ptr</span><span class="o">-&gt;</span><span class="n">read_data_fn</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span>
<a name="line-213"></a>   <span class="p">{</span>
<a name="line-214"></a>      <span class="n">png_ptr</span><span class="o">-&gt;</span><span class="n">read_data_fn</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
<a name="line-215"></a>
<a name="line-216"></a>      <span class="n">png_warning</span><span class="p">(</span><span class="n">png_ptr</span><span class="p">,</span>
<a name="line-217"></a>          <span class="s">&quot;Can&#39;t set both read_data_fn and write_data_fn in the&quot;</span>
<a name="line-218"></a>          <span class="s">&quot; same structure&quot;</span><span class="p">);</span>
<a name="line-219"></a>   <span class="p">}</span>
<a name="line-220"></a><span class="p">}</span>
<a name="line-221"></a>
<a name="line-222"></a><span class="cp">#ifdef USE_FAR_KEYWORD</span>
<a name="line-223"></a><span class="cp">#  ifdef _MSC_VER</span>
<a name="line-224"></a><span class="kt">void</span> <span class="o">*</span><span class="n">png_far_to_near</span><span class="p">(</span><span class="n">png_structp</span> <span class="n">png_ptr</span><span class="p">,</span> <span class="n">png_voidp</span> <span class="n">ptr</span><span class="p">,</span> <span class="kt">int</span> <span class="n">check</span><span class="p">)</span>
<a name="line-225"></a><span class="p">{</span>
<a name="line-226"></a>   <span class="kt">void</span> <span class="o">*</span><span class="n">near_ptr</span><span class="p">;</span>
<a name="line-227"></a>   <span class="kt">void</span> <span class="n">FAR</span> <span class="o">*</span><span class="n">far_ptr</span><span class="p">;</span>
<a name="line-228"></a>   <span class="n">FP_OFF</span><span class="p">(</span><span class="n">near_ptr</span><span class="p">)</span> <span class="o">=</span> <span class="n">FP_OFF</span><span class="p">(</span><span class="n">ptr</span><span class="p">);</span>
<a name="line-229"></a>   <span class="n">far_ptr</span> <span class="o">=</span> <span class="p">(</span><span class="kt">void</span> <span class="n">FAR</span> <span class="o">*</span><span class="p">)</span><span class="n">near_ptr</span><span class="p">;</span>
<a name="line-230"></a>
<a name="line-231"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">check</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
<a name="line-232"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">FP_SEG</span><span class="p">(</span><span class="n">ptr</span><span class="p">)</span> <span class="o">!=</span> <span class="n">FP_SEG</span><span class="p">(</span><span class="n">far_ptr</span><span class="p">))</span>
<a name="line-233"></a>         <span class="n">png_error</span><span class="p">(</span><span class="n">png_ptr</span><span class="p">,</span> <span class="s">&quot;segment lost in conversion&quot;</span><span class="p">);</span>
<a name="line-234"></a>
<a name="line-235"></a>   <span class="k">return</span><span class="p">(</span><span class="n">near_ptr</span><span class="p">);</span>
<a name="line-236"></a><span class="p">}</span>
<a name="line-237"></a><span class="cp">#  else</span>
<a name="line-238"></a><span class="kt">void</span> <span class="o">*</span><span class="n">png_far_to_near</span><span class="p">(</span><span class="n">png_structp</span> <span class="n">png_ptr</span><span class="p">,</span> <span class="n">png_voidp</span> <span class="n">ptr</span><span class="p">,</span> <span class="kt">int</span> <span class="n">check</span><span class="p">)</span>
<a name="line-239"></a><span class="p">{</span>
<a name="line-240"></a>   <span class="kt">void</span> <span class="o">*</span><span class="n">near_ptr</span><span class="p">;</span>
<a name="line-241"></a>   <span class="kt">void</span> <span class="n">FAR</span> <span class="o">*</span><span class="n">far_ptr</span><span class="p">;</span>
<a name="line-242"></a>   <span class="n">near_ptr</span> <span class="o">=</span> <span class="p">(</span><span class="kt">void</span> <span class="n">FAR</span> <span class="o">*</span><span class="p">)</span><span class="n">ptr</span><span class="p">;</span>
<a name="line-243"></a>   <span class="n">far_ptr</span> <span class="o">=</span> <span class="p">(</span><span class="kt">void</span> <span class="n">FAR</span> <span class="o">*</span><span class="p">)</span><span class="n">near_ptr</span><span class="p">;</span>
<a name="line-244"></a>
<a name="line-245"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">check</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
<a name="line-246"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">far_ptr</span> <span class="o">!=</span> <span class="n">ptr</span><span class="p">)</span>
<a name="line-247"></a>         <span class="n">png_error</span><span class="p">(</span><span class="n">png_ptr</span><span class="p">,</span> <span class="s">&quot;segment lost in conversion&quot;</span><span class="p">);</span>
<a name="line-248"></a>
<a name="line-249"></a>   <span class="k">return</span><span class="p">(</span><span class="n">near_ptr</span><span class="p">);</span>
<a name="line-250"></a><span class="p">}</span>
<a name="line-251"></a><span class="cp">#  endif</span>
<a name="line-252"></a><span class="cp">#endif</span>
<a name="line-253"></a><span class="cp">#endif </span><span class="cm">/* PNG_WRITE_SUPPORTED */</span><span class="cp"></span>
</pre></div>
</td></tr></table>
      </div>
      <div id="footer">
        <p>
         Cppcheck 1.70 dev - a tool for static C/C++ code analysis</br>
         </br>
         Internet: <a href="http://cppcheck.sourceforge.net">http://cppcheck.sourceforge.net</a></br>
         IRC: <a href="irc://irc.freenode.net/cppcheck">irc://irc.freenode.net/cppcheck</a></br>
        <p>
      </div>
  </body>
</html>
