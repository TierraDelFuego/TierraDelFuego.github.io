
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Cppcheck - HTML report - [project name]</title>
    <link rel="stylesheet" href="style.css">
    <style>
.highlight .hll { background-color: #ffffcc }
.highlight  { background: #ffffff; }
.highlight .c { color: #888888 } /* Comment */
.highlight .err { color: #FF0000; background-color: #FFAAAA } /* Error */
.highlight .k { color: #008800; font-weight: bold } /* Keyword */
.highlight .o { color: #333333 } /* Operator */
.highlight .cm { color: #888888 } /* Comment.Multiline */
.highlight .cp { color: #557799 } /* Comment.Preproc */
.highlight .c1 { color: #888888 } /* Comment.Single */
.highlight .cs { color: #cc0000; font-weight: bold } /* Comment.Special */
.highlight .gd { color: #A00000 } /* Generic.Deleted */
.highlight .ge { font-style: italic } /* Generic.Emph */
.highlight .gr { color: #FF0000 } /* Generic.Error */
.highlight .gh { color: #000080; font-weight: bold } /* Generic.Heading */
.highlight .gi { color: #00A000 } /* Generic.Inserted */
.highlight .go { color: #888888 } /* Generic.Output */
.highlight .gp { color: #c65d09; font-weight: bold } /* Generic.Prompt */
.highlight .gs { font-weight: bold } /* Generic.Strong */
.highlight .gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.highlight .gt { color: #0044DD } /* Generic.Traceback */
.highlight .kc { color: #008800; font-weight: bold } /* Keyword.Constant */
.highlight .kd { color: #008800; font-weight: bold } /* Keyword.Declaration */
.highlight .kn { color: #008800; font-weight: bold } /* Keyword.Namespace */
.highlight .kp { color: #003388; font-weight: bold } /* Keyword.Pseudo */
.highlight .kr { color: #008800; font-weight: bold } /* Keyword.Reserved */
.highlight .kt { color: #333399; font-weight: bold } /* Keyword.Type */
.highlight .m { color: #6600EE; font-weight: bold } /* Literal.Number */
.highlight .s { background-color: #fff0f0 } /* Literal.String */
.highlight .na { color: #0000CC } /* Name.Attribute */
.highlight .nb { color: #007020 } /* Name.Builtin */
.highlight .nc { color: #BB0066; font-weight: bold } /* Name.Class */
.highlight .no { color: #003366; font-weight: bold } /* Name.Constant */
.highlight .nd { color: #555555; font-weight: bold } /* Name.Decorator */
.highlight .ni { color: #880000; font-weight: bold } /* Name.Entity */
.highlight .ne { color: #FF0000; font-weight: bold } /* Name.Exception */
.highlight .nf { color: #0066BB; font-weight: bold } /* Name.Function */
.highlight .nl { color: #997700; font-weight: bold } /* Name.Label */
.highlight .nn { color: #0e84b5; font-weight: bold } /* Name.Namespace */
.highlight .nt { color: #007700 } /* Name.Tag */
.highlight .nv { color: #996633 } /* Name.Variable */
.highlight .ow { color: #000000; font-weight: bold } /* Operator.Word */
.highlight .w { color: #bbbbbb } /* Text.Whitespace */
.highlight .mb { color: #6600EE; font-weight: bold } /* Literal.Number.Bin */
.highlight .mf { color: #6600EE; font-weight: bold } /* Literal.Number.Float */
.highlight .mh { color: #005588; font-weight: bold } /* Literal.Number.Hex */
.highlight .mi { color: #0000DD; font-weight: bold } /* Literal.Number.Integer */
.highlight .mo { color: #4400EE; font-weight: bold } /* Literal.Number.Oct */
.highlight .sb { background-color: #fff0f0 } /* Literal.String.Backtick */
.highlight .sc { color: #0044DD } /* Literal.String.Char */
.highlight .sd { color: #DD4422 } /* Literal.String.Doc */
.highlight .s2 { background-color: #fff0f0 } /* Literal.String.Double */
.highlight .se { color: #666666; font-weight: bold; background-color: #fff0f0 } /* Literal.String.Escape */
.highlight .sh { background-color: #fff0f0 } /* Literal.String.Heredoc */
.highlight .si { background-color: #eeeeee } /* Literal.String.Interpol */
.highlight .sx { color: #DD2200; background-color: #fff0f0 } /* Literal.String.Other */
.highlight .sr { color: #000000; background-color: #fff0ff } /* Literal.String.Regex */
.highlight .s1 { background-color: #fff0f0 } /* Literal.String.Single */
.highlight .ss { color: #AA6600 } /* Literal.String.Symbol */
.highlight .bp { color: #007020 } /* Name.Builtin.Pseudo */
.highlight .vc { color: #336699 } /* Name.Variable.Class */
.highlight .vg { color: #dd7700; font-weight: bold } /* Name.Variable.Global */
.highlight .vi { color: #3333BB } /* Name.Variable.Instance */
.highlight .il { color: #0000DD; font-weight: bold } /* Literal.Number.Integer.Long */
    </style>
    <script language="javascript">
      function getStyle(el,styleProp) {
        if (el.currentStyle)
          var y = el.currentStyle[styleProp];
        else if (window.getComputedStyle)
          var y = document.defaultView.getComputedStyle(el,null).getPropertyValue(styleProp);
        return y;
      }
      function toggle() {
        var el = this.expandable_content;
        var mark = this.expandable_marker;
        if (el.style.display == "block") {
          el.style.display = "none";
          mark.innerHTML = "[+]";
        } else {
          el.style.display = "block";
          mark.innerHTML = "[-]";
        }
      }
      function init_expandables() {
        var elts = document.getElementsByClassName("expandable");
        for (var i = 0; i < elts.length; i++) {
          var el = elts[i];
          var clickable = el.getElementsByTagName("span")[0];
          var marker = clickable.getElementsByClassName("marker")[0];
          var content = el.getElementsByClassName("content")[0];
          var width = clickable.clientWidth - parseInt(getStyle(content, "padding-left")) - parseInt(getStyle(content, "padding-right"));
          content.style.width = width + "px";
          clickable.expandable_content = content;
          clickable.expandable_marker = marker;
          clickable.onclick = toggle;
        }
      }
    </script>
  </head>
  <body onload="init_expandables()">
      <div id="header">
        <h1>Cppcheck report - [project name]: ../../godot/drivers/builtin_zlib/zlib/inftrees.c </h1>
      </div>
      <div id="menu" dir="rtl">
       <p id="filename"><a href="index.html">Defects:</a> inftrees.c</p>
<a href='398.html#line-50'> variableScope 50</a>
      </div>
      <div id="content">
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306</pre></div></td><td class="code"><div class="highlight"><pre><a name="line-1"></a><span class="cm">/* inftrees.c -- generate Huffman trees for efficient decoding</span>
<a name="line-2"></a><span class="cm"> * Copyright (C) 1995-2012 Mark Adler</span>
<a name="line-3"></a><span class="cm"> * For conditions of distribution and use, see copyright notice in zlib.h</span>
<a name="line-4"></a><span class="cm"> */</span>
<a name="line-5"></a>
<a name="line-6"></a><span class="cp">#include &quot;zutil.h&quot;</span>
<a name="line-7"></a><span class="cp">#include &quot;inftrees.h&quot;</span>
<a name="line-8"></a>
<a name="line-9"></a><span class="cp">#define MAXBITS 15</span>
<a name="line-10"></a>
<a name="line-11"></a><span class="k">const</span> <span class="kt">char</span> <span class="n">inflate_copyright</span><span class="p">[]</span> <span class="o">=</span>
<a name="line-12"></a>   <span class="s">&quot; inflate 1.2.7 Copyright 1995-2012 Mark Adler &quot;</span><span class="p">;</span>
<a name="line-13"></a><span class="cm">/*</span>
<a name="line-14"></a><span class="cm">  If you use the zlib library in a product, an acknowledgment is welcome</span>
<a name="line-15"></a><span class="cm">  in the documentation of your product. If for some reason you cannot</span>
<a name="line-16"></a><span class="cm">  include such an acknowledgment, I would appreciate that you keep this</span>
<a name="line-17"></a><span class="cm">  copyright string in the executable of your product.</span>
<a name="line-18"></a><span class="cm"> */</span>
<a name="line-19"></a>
<a name="line-20"></a><span class="cm">/*</span>
<a name="line-21"></a><span class="cm">   Build a set of tables to decode the provided canonical Huffman code.</span>
<a name="line-22"></a><span class="cm">   The code lengths are lens[0..codes-1].  The result starts at *table,</span>
<a name="line-23"></a><span class="cm">   whose indices are 0..2^bits-1.  work is a writable array of at least</span>
<a name="line-24"></a><span class="cm">   lens shorts, which is used as a work area.  type is the type of code</span>
<a name="line-25"></a><span class="cm">   to be generated, CODES, LENS, or DISTS.  On return, zero is success,</span>
<a name="line-26"></a><span class="cm">   -1 is an invalid code, and +1 means that ENOUGH isn&#39;t enough.  table</span>
<a name="line-27"></a><span class="cm">   on return points to the next available entry&#39;s address.  bits is the</span>
<a name="line-28"></a><span class="cm">   requested root table index bits, and on return it is the actual root</span>
<a name="line-29"></a><span class="cm">   table index bits.  It will differ if the request is greater than the</span>
<a name="line-30"></a><span class="cm">   longest code or if it is less than the shortest code.</span>
<a name="line-31"></a><span class="cm"> */</span>
<a name="line-32"></a><span class="kt">int</span> <span class="n">ZLIB_INTERNAL</span> <span class="n">inflate_table</span><span class="p">(</span><span class="n">type</span><span class="p">,</span> <span class="n">lens</span><span class="p">,</span> <span class="n">codes</span><span class="p">,</span> <span class="n">table</span><span class="p">,</span> <span class="n">bits</span><span class="p">,</span> <span class="n">work</span><span class="p">)</span>
<a name="line-33"></a><span class="n">codetype</span> <span class="n">type</span><span class="p">;</span>
<a name="line-34"></a><span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">FAR</span> <span class="o">*</span><span class="n">lens</span><span class="p">;</span>
<a name="line-35"></a><span class="kt">unsigned</span> <span class="n">codes</span><span class="p">;</span>
<a name="line-36"></a><span class="n">code</span> <span class="n">FAR</span> <span class="o">*</span> <span class="n">FAR</span> <span class="o">*</span><span class="n">table</span><span class="p">;</span>
<a name="line-37"></a><span class="kt">unsigned</span> <span class="n">FAR</span> <span class="o">*</span><span class="n">bits</span><span class="p">;</span>
<a name="line-38"></a><span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">FAR</span> <span class="o">*</span><span class="n">work</span><span class="p">;</span>
<a name="line-39"></a><span class="p">{</span>
<a name="line-40"></a>    <span class="kt">unsigned</span> <span class="n">len</span><span class="p">;</span>               <span class="cm">/* a code&#39;s length in bits */</span>
<a name="line-41"></a>    <span class="kt">unsigned</span> <span class="n">sym</span><span class="p">;</span>               <span class="cm">/* index of code symbols */</span>
<a name="line-42"></a>    <span class="kt">unsigned</span> <span class="n">min</span><span class="p">,</span> <span class="n">max</span><span class="p">;</span>          <span class="cm">/* minimum and maximum code lengths */</span>
<a name="line-43"></a>    <span class="kt">unsigned</span> <span class="n">root</span><span class="p">;</span>              <span class="cm">/* number of index bits for root table */</span>
<a name="line-44"></a>    <span class="kt">unsigned</span> <span class="n">curr</span><span class="p">;</span>              <span class="cm">/* number of index bits for current table */</span>
<a name="line-45"></a>    <span class="kt">unsigned</span> <span class="n">drop</span><span class="p">;</span>              <span class="cm">/* code bits to drop for sub-table */</span>
<a name="line-46"></a>    <span class="kt">int</span> <span class="n">left</span><span class="p">;</span>                   <span class="cm">/* number of prefix codes available */</span>
<a name="line-47"></a>    <span class="kt">unsigned</span> <span class="n">used</span><span class="p">;</span>              <span class="cm">/* code entries in table used */</span>
<a name="line-48"></a>    <span class="kt">unsigned</span> <span class="n">huff</span><span class="p">;</span>              <span class="cm">/* Huffman code */</span>
<a name="line-49"></a>    <span class="kt">unsigned</span> <span class="n">incr</span><span class="p">;</span>              <span class="cm">/* for incrementing code, index */</span>
<a name="line-50"></a><span class="hll">    <span class="kt">unsigned</span> <span class="n">fill</span><span class="p">;</span>              <span class="cm">/* index for replicating entries */</span><div class='verbose expandable'><span class='error2'>&lt;--- The scope of the variable 'fill' can be reduced. <span class='marker'>[+]</span></span><div class='content'>The scope of the variable &apos;fill&apos; can be reduced. Warning: Be careful when fixing this message, especially when there are inner loops. Here is an example where cppcheck will write that the scope for &apos;i&apos; can be reduced:
void f(int x)
{
    int i = 0;
    if (x) {
        // it&apos;s safe to move &apos;int i = 0;&apos; here
        for (int n = 0; n &lt; 10; ++n) {
            // it is possible but not safe to move &apos;int i = 0;&apos; here
            do_something(&amp;i);
        }
    }
}
When you see this message it is always safe to reduce the variable scope 1 level.</div></div>
</span><a name="line-51"></a>    <span class="kt">unsigned</span> <span class="n">low</span><span class="p">;</span>               <span class="cm">/* low bits for current root entry */</span>
<a name="line-52"></a>    <span class="kt">unsigned</span> <span class="n">mask</span><span class="p">;</span>              <span class="cm">/* mask for low root bits */</span>
<a name="line-53"></a>    <span class="n">code</span> <span class="n">here</span><span class="p">;</span>                  <span class="cm">/* table entry for duplication */</span>
<a name="line-54"></a>    <span class="n">code</span> <span class="n">FAR</span> <span class="o">*</span><span class="n">next</span><span class="p">;</span>             <span class="cm">/* next available space in table */</span>
<a name="line-55"></a>    <span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">FAR</span> <span class="o">*</span><span class="n">base</span><span class="p">;</span>     <span class="cm">/* base value table to use */</span>
<a name="line-56"></a>    <span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">FAR</span> <span class="o">*</span><span class="n">extra</span><span class="p">;</span>    <span class="cm">/* extra bits table to use */</span>
<a name="line-57"></a>    <span class="kt">int</span> <span class="n">end</span><span class="p">;</span>                    <span class="cm">/* use base and extra for symbol &gt; end */</span>
<a name="line-58"></a>    <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">count</span><span class="p">[</span><span class="n">MAXBITS</span><span class="o">+</span><span class="mi">1</span><span class="p">];</span>    <span class="cm">/* number of codes of each length */</span>
<a name="line-59"></a>    <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">offs</span><span class="p">[</span><span class="n">MAXBITS</span><span class="o">+</span><span class="mi">1</span><span class="p">];</span>     <span class="cm">/* offsets in table for each length */</span>
<a name="line-60"></a>    <span class="k">static</span> <span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">lbase</span><span class="p">[</span><span class="mi">31</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="cm">/* Length codes 257..285 base */</span>
<a name="line-61"></a>        <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">19</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mi">27</span><span class="p">,</span> <span class="mi">31</span><span class="p">,</span>
<a name="line-62"></a>        <span class="mi">35</span><span class="p">,</span> <span class="mi">43</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">59</span><span class="p">,</span> <span class="mi">67</span><span class="p">,</span> <span class="mi">83</span><span class="p">,</span> <span class="mi">99</span><span class="p">,</span> <span class="mi">115</span><span class="p">,</span> <span class="mi">131</span><span class="p">,</span> <span class="mi">163</span><span class="p">,</span> <span class="mi">195</span><span class="p">,</span> <span class="mi">227</span><span class="p">,</span> <span class="mi">258</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">};</span>
<a name="line-63"></a>    <span class="k">static</span> <span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">lext</span><span class="p">[</span><span class="mi">31</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="cm">/* Length codes 257..285 extra */</span>
<a name="line-64"></a>        <span class="mi">16</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span>
<a name="line-65"></a>        <span class="mi">19</span><span class="p">,</span> <span class="mi">19</span><span class="p">,</span> <span class="mi">19</span><span class="p">,</span> <span class="mi">19</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">21</span><span class="p">,</span> <span class="mi">21</span><span class="p">,</span> <span class="mi">21</span><span class="p">,</span> <span class="mi">21</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">78</span><span class="p">,</span> <span class="mi">68</span><span class="p">};</span>
<a name="line-66"></a>    <span class="k">static</span> <span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">dbase</span><span class="p">[</span><span class="mi">32</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="cm">/* Distance codes 0..29 base */</span>
<a name="line-67"></a>        <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">33</span><span class="p">,</span> <span class="mi">49</span><span class="p">,</span> <span class="mi">65</span><span class="p">,</span> <span class="mi">97</span><span class="p">,</span> <span class="mi">129</span><span class="p">,</span> <span class="mi">193</span><span class="p">,</span>
<a name="line-68"></a>        <span class="mi">257</span><span class="p">,</span> <span class="mi">385</span><span class="p">,</span> <span class="mi">513</span><span class="p">,</span> <span class="mi">769</span><span class="p">,</span> <span class="mi">1025</span><span class="p">,</span> <span class="mi">1537</span><span class="p">,</span> <span class="mi">2049</span><span class="p">,</span> <span class="mi">3073</span><span class="p">,</span> <span class="mi">4097</span><span class="p">,</span> <span class="mi">6145</span><span class="p">,</span>
<a name="line-69"></a>        <span class="mi">8193</span><span class="p">,</span> <span class="mi">12289</span><span class="p">,</span> <span class="mi">16385</span><span class="p">,</span> <span class="mi">24577</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">};</span>
<a name="line-70"></a>    <span class="k">static</span> <span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">dext</span><span class="p">[</span><span class="mi">32</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="cm">/* Distance codes 0..29 extra */</span>
<a name="line-71"></a>        <span class="mi">16</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">19</span><span class="p">,</span> <span class="mi">19</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">21</span><span class="p">,</span> <span class="mi">21</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span>
<a name="line-72"></a>        <span class="mi">23</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">26</span><span class="p">,</span> <span class="mi">26</span><span class="p">,</span> <span class="mi">27</span><span class="p">,</span> <span class="mi">27</span><span class="p">,</span>
<a name="line-73"></a>        <span class="mi">28</span><span class="p">,</span> <span class="mi">28</span><span class="p">,</span> <span class="mi">29</span><span class="p">,</span> <span class="mi">29</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">64</span><span class="p">};</span>
<a name="line-74"></a>
<a name="line-75"></a>    <span class="cm">/*</span>
<a name="line-76"></a><span class="cm">       Process a set of code lengths to create a canonical Huffman code.  The</span>
<a name="line-77"></a><span class="cm">       code lengths are lens[0..codes-1].  Each length corresponds to the</span>
<a name="line-78"></a><span class="cm">       symbols 0..codes-1.  The Huffman code is generated by first sorting the</span>
<a name="line-79"></a><span class="cm">       symbols by length from short to long, and retaining the symbol order</span>
<a name="line-80"></a><span class="cm">       for codes with equal lengths.  Then the code starts with all zero bits</span>
<a name="line-81"></a><span class="cm">       for the first code of the shortest length, and the codes are integer</span>
<a name="line-82"></a><span class="cm">       increments for the same length, and zeros are appended as the length</span>
<a name="line-83"></a><span class="cm">       increases.  For the deflate format, these bits are stored backwards</span>
<a name="line-84"></a><span class="cm">       from their more natural integer increment ordering, and so when the</span>
<a name="line-85"></a><span class="cm">       decoding tables are built in the large loop below, the integer codes</span>
<a name="line-86"></a><span class="cm">       are incremented backwards.</span>
<a name="line-87"></a>
<a name="line-88"></a><span class="cm">       This routine assumes, but does not check, that all of the entries in</span>
<a name="line-89"></a><span class="cm">       lens[] are in the range 0..MAXBITS.  The caller must assure this.</span>
<a name="line-90"></a><span class="cm">       1..MAXBITS is interpreted as that code length.  zero means that that</span>
<a name="line-91"></a><span class="cm">       symbol does not occur in this code.</span>
<a name="line-92"></a>
<a name="line-93"></a><span class="cm">       The codes are sorted by computing a count of codes for each length,</span>
<a name="line-94"></a><span class="cm">       creating from that a table of starting indices for each length in the</span>
<a name="line-95"></a><span class="cm">       sorted table, and then entering the symbols in order in the sorted</span>
<a name="line-96"></a><span class="cm">       table.  The sorted table is work[], with that space being provided by</span>
<a name="line-97"></a><span class="cm">       the caller.</span>
<a name="line-98"></a>
<a name="line-99"></a><span class="cm">       The length counts are used for other purposes as well, i.e. finding</span>
<a name="line-100"></a><span class="cm">       the minimum and maximum length codes, determining if there are any</span>
<a name="line-101"></a><span class="cm">       codes at all, checking for a valid set of lengths, and looking ahead</span>
<a name="line-102"></a><span class="cm">       at length counts to determine sub-table sizes when building the</span>
<a name="line-103"></a><span class="cm">       decoding tables.</span>
<a name="line-104"></a><span class="cm">     */</span>
<a name="line-105"></a>
<a name="line-106"></a>    <span class="cm">/* accumulate lengths for codes (assumes lens[] all in 0..MAXBITS) */</span>
<a name="line-107"></a>    <span class="k">for</span> <span class="p">(</span><span class="n">len</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">len</span> <span class="o">&lt;=</span> <span class="n">MAXBITS</span><span class="p">;</span> <span class="n">len</span><span class="o">++</span><span class="p">)</span>
<a name="line-108"></a>        <span class="n">count</span><span class="p">[</span><span class="n">len</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<a name="line-109"></a>    <span class="k">for</span> <span class="p">(</span><span class="n">sym</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">sym</span> <span class="o">&lt;</span> <span class="n">codes</span><span class="p">;</span> <span class="n">sym</span><span class="o">++</span><span class="p">)</span>
<a name="line-110"></a>        <span class="n">count</span><span class="p">[</span><span class="n">lens</span><span class="p">[</span><span class="n">sym</span><span class="p">]]</span><span class="o">++</span><span class="p">;</span>
<a name="line-111"></a>
<a name="line-112"></a>    <span class="cm">/* bound code lengths, force root to be within code lengths */</span>
<a name="line-113"></a>    <span class="n">root</span> <span class="o">=</span> <span class="o">*</span><span class="n">bits</span><span class="p">;</span>
<a name="line-114"></a>    <span class="k">for</span> <span class="p">(</span><span class="n">max</span> <span class="o">=</span> <span class="n">MAXBITS</span><span class="p">;</span> <span class="n">max</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">max</span><span class="o">--</span><span class="p">)</span>
<a name="line-115"></a>        <span class="k">if</span> <span class="p">(</span><span class="n">count</span><span class="p">[</span><span class="n">max</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="k">break</span><span class="p">;</span>
<a name="line-116"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">root</span> <span class="o">&gt;</span> <span class="n">max</span><span class="p">)</span> <span class="n">root</span> <span class="o">=</span> <span class="n">max</span><span class="p">;</span>
<a name="line-117"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">max</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>                     <span class="cm">/* no symbols to code at all */</span>
<a name="line-118"></a>        <span class="n">here</span><span class="p">.</span><span class="n">op</span> <span class="o">=</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">char</span><span class="p">)</span><span class="mi">64</span><span class="p">;</span>    <span class="cm">/* invalid code marker */</span>
<a name="line-119"></a>        <span class="n">here</span><span class="p">.</span><span class="n">bits</span> <span class="o">=</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">char</span><span class="p">)</span><span class="mi">1</span><span class="p">;</span>
<a name="line-120"></a>        <span class="n">here</span><span class="p">.</span><span class="n">val</span> <span class="o">=</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">short</span><span class="p">)</span><span class="mi">0</span><span class="p">;</span>
<a name="line-121"></a>        <span class="o">*</span><span class="p">(</span><span class="o">*</span><span class="n">table</span><span class="p">)</span><span class="o">++</span> <span class="o">=</span> <span class="n">here</span><span class="p">;</span>             <span class="cm">/* make a table to force an error */</span>
<a name="line-122"></a>        <span class="o">*</span><span class="p">(</span><span class="o">*</span><span class="n">table</span><span class="p">)</span><span class="o">++</span> <span class="o">=</span> <span class="n">here</span><span class="p">;</span>
<a name="line-123"></a>        <span class="o">*</span><span class="n">bits</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<a name="line-124"></a>        <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>     <span class="cm">/* no symbols, but wait for decoding to report error */</span>
<a name="line-125"></a>    <span class="p">}</span>
<a name="line-126"></a>    <span class="k">for</span> <span class="p">(</span><span class="n">min</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">min</span> <span class="o">&lt;</span> <span class="n">max</span><span class="p">;</span> <span class="n">min</span><span class="o">++</span><span class="p">)</span>
<a name="line-127"></a>        <span class="k">if</span> <span class="p">(</span><span class="n">count</span><span class="p">[</span><span class="n">min</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="k">break</span><span class="p">;</span>
<a name="line-128"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">root</span> <span class="o">&lt;</span> <span class="n">min</span><span class="p">)</span> <span class="n">root</span> <span class="o">=</span> <span class="n">min</span><span class="p">;</span>
<a name="line-129"></a>
<a name="line-130"></a>    <span class="cm">/* check for an over-subscribed or incomplete set of lengths */</span>
<a name="line-131"></a>    <span class="n">left</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<a name="line-132"></a>    <span class="k">for</span> <span class="p">(</span><span class="n">len</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">len</span> <span class="o">&lt;=</span> <span class="n">MAXBITS</span><span class="p">;</span> <span class="n">len</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
<a name="line-133"></a>        <span class="n">left</span> <span class="o">&lt;&lt;=</span> <span class="mi">1</span><span class="p">;</span>
<a name="line-134"></a>        <span class="n">left</span> <span class="o">-=</span> <span class="n">count</span><span class="p">[</span><span class="n">len</span><span class="p">];</span>
<a name="line-135"></a>        <span class="k">if</span> <span class="p">(</span><span class="n">left</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>        <span class="cm">/* over-subscribed */</span>
<a name="line-136"></a>    <span class="p">}</span>
<a name="line-137"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">left</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">type</span> <span class="o">==</span> <span class="n">CODES</span> <span class="o">||</span> <span class="n">max</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">))</span>
<a name="line-138"></a>        <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>                      <span class="cm">/* incomplete set */</span>
<a name="line-139"></a>
<a name="line-140"></a>    <span class="cm">/* generate offsets into symbol table for each length for sorting */</span>
<a name="line-141"></a>    <span class="n">offs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<a name="line-142"></a>    <span class="k">for</span> <span class="p">(</span><span class="n">len</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">len</span> <span class="o">&lt;</span> <span class="n">MAXBITS</span><span class="p">;</span> <span class="n">len</span><span class="o">++</span><span class="p">)</span>
<a name="line-143"></a>        <span class="n">offs</span><span class="p">[</span><span class="n">len</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">offs</span><span class="p">[</span><span class="n">len</span><span class="p">]</span> <span class="o">+</span> <span class="n">count</span><span class="p">[</span><span class="n">len</span><span class="p">];</span>
<a name="line-144"></a>
<a name="line-145"></a>    <span class="cm">/* sort symbols by length, by symbol order within each length */</span>
<a name="line-146"></a>    <span class="k">for</span> <span class="p">(</span><span class="n">sym</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">sym</span> <span class="o">&lt;</span> <span class="n">codes</span><span class="p">;</span> <span class="n">sym</span><span class="o">++</span><span class="p">)</span>
<a name="line-147"></a>        <span class="k">if</span> <span class="p">(</span><span class="n">lens</span><span class="p">[</span><span class="n">sym</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="n">work</span><span class="p">[</span><span class="n">offs</span><span class="p">[</span><span class="n">lens</span><span class="p">[</span><span class="n">sym</span><span class="p">]]</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">short</span><span class="p">)</span><span class="n">sym</span><span class="p">;</span>
<a name="line-148"></a>
<a name="line-149"></a>    <span class="cm">/*</span>
<a name="line-150"></a><span class="cm">       Create and fill in decoding tables.  In this loop, the table being</span>
<a name="line-151"></a><span class="cm">       filled is at next and has curr index bits.  The code being used is huff</span>
<a name="line-152"></a><span class="cm">       with length len.  That code is converted to an index by dropping drop</span>
<a name="line-153"></a><span class="cm">       bits off of the bottom.  For codes where len is less than drop + curr,</span>
<a name="line-154"></a><span class="cm">       those top drop + curr - len bits are incremented through all values to</span>
<a name="line-155"></a><span class="cm">       fill the table with replicated entries.</span>
<a name="line-156"></a>
<a name="line-157"></a><span class="cm">       root is the number of index bits for the root table.  When len exceeds</span>
<a name="line-158"></a><span class="cm">       root, sub-tables are created pointed to by the root entry with an index</span>
<a name="line-159"></a><span class="cm">       of the low root bits of huff.  This is saved in low to check for when a</span>
<a name="line-160"></a><span class="cm">       new sub-table should be started.  drop is zero when the root table is</span>
<a name="line-161"></a><span class="cm">       being filled, and drop is root when sub-tables are being filled.</span>
<a name="line-162"></a>
<a name="line-163"></a><span class="cm">       When a new sub-table is needed, it is necessary to look ahead in the</span>
<a name="line-164"></a><span class="cm">       code lengths to determine what size sub-table is needed.  The length</span>
<a name="line-165"></a><span class="cm">       counts are used for this, and so count[] is decremented as codes are</span>
<a name="line-166"></a><span class="cm">       entered in the tables.</span>
<a name="line-167"></a>
<a name="line-168"></a><span class="cm">       used keeps track of how many table entries have been allocated from the</span>
<a name="line-169"></a><span class="cm">       provided *table space.  It is checked for LENS and DIST tables against</span>
<a name="line-170"></a><span class="cm">       the constants ENOUGH_LENS and ENOUGH_DISTS to guard against changes in</span>
<a name="line-171"></a><span class="cm">       the initial root table size constants.  See the comments in inftrees.h</span>
<a name="line-172"></a><span class="cm">       for more information.</span>
<a name="line-173"></a>
<a name="line-174"></a><span class="cm">       sym increments through all symbols, and the loop terminates when</span>
<a name="line-175"></a><span class="cm">       all codes of length max, i.e. all codes, have been processed.  This</span>
<a name="line-176"></a><span class="cm">       routine permits incomplete codes, so another loop after this one fills</span>
<a name="line-177"></a><span class="cm">       in the rest of the decoding tables with invalid code markers.</span>
<a name="line-178"></a><span class="cm">     */</span>
<a name="line-179"></a>
<a name="line-180"></a>    <span class="cm">/* set up for code type */</span>
<a name="line-181"></a>    <span class="k">switch</span> <span class="p">(</span><span class="n">type</span><span class="p">)</span> <span class="p">{</span>
<a name="line-182"></a>    <span class="k">case</span> <span class="nl">CODES</span><span class="p">:</span>
<a name="line-183"></a>        <span class="n">base</span> <span class="o">=</span> <span class="n">extra</span> <span class="o">=</span> <span class="n">work</span><span class="p">;</span>    <span class="cm">/* dummy value--not used */</span>
<a name="line-184"></a>        <span class="n">end</span> <span class="o">=</span> <span class="mi">19</span><span class="p">;</span>
<a name="line-185"></a>        <span class="k">break</span><span class="p">;</span>
<a name="line-186"></a>    <span class="k">case</span> <span class="nl">LENS</span><span class="p">:</span>
<a name="line-187"></a>        <span class="n">base</span> <span class="o">=</span> <span class="n">lbase</span><span class="p">;</span>
<a name="line-188"></a>        <span class="n">base</span> <span class="o">-=</span> <span class="mi">257</span><span class="p">;</span>
<a name="line-189"></a>        <span class="n">extra</span> <span class="o">=</span> <span class="n">lext</span><span class="p">;</span>
<a name="line-190"></a>        <span class="n">extra</span> <span class="o">-=</span> <span class="mi">257</span><span class="p">;</span>
<a name="line-191"></a>        <span class="n">end</span> <span class="o">=</span> <span class="mi">256</span><span class="p">;</span>
<a name="line-192"></a>        <span class="k">break</span><span class="p">;</span>
<a name="line-193"></a>    <span class="k">default</span><span class="o">:</span>            <span class="cm">/* DISTS */</span>
<a name="line-194"></a>        <span class="n">base</span> <span class="o">=</span> <span class="n">dbase</span><span class="p">;</span>
<a name="line-195"></a>        <span class="n">extra</span> <span class="o">=</span> <span class="n">dext</span><span class="p">;</span>
<a name="line-196"></a>        <span class="n">end</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
<a name="line-197"></a>    <span class="p">}</span>
<a name="line-198"></a>
<a name="line-199"></a>    <span class="cm">/* initialize state for loop */</span>
<a name="line-200"></a>    <span class="n">huff</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>                   <span class="cm">/* starting code */</span>
<a name="line-201"></a>    <span class="n">sym</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>                    <span class="cm">/* starting code symbol */</span>
<a name="line-202"></a>    <span class="n">len</span> <span class="o">=</span> <span class="n">min</span><span class="p">;</span>                  <span class="cm">/* starting code length */</span>
<a name="line-203"></a>    <span class="n">next</span> <span class="o">=</span> <span class="o">*</span><span class="n">table</span><span class="p">;</span>              <span class="cm">/* current table to fill in */</span>
<a name="line-204"></a>    <span class="n">curr</span> <span class="o">=</span> <span class="n">root</span><span class="p">;</span>                <span class="cm">/* current table index bits */</span>
<a name="line-205"></a>    <span class="n">drop</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>                   <span class="cm">/* current bits to drop from code for index */</span>
<a name="line-206"></a>    <span class="n">low</span> <span class="o">=</span> <span class="p">(</span><span class="kt">unsigned</span><span class="p">)(</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>       <span class="cm">/* trigger new sub-table when len &gt; root */</span>
<a name="line-207"></a>    <span class="n">used</span> <span class="o">=</span> <span class="mi">1U</span> <span class="o">&lt;&lt;</span> <span class="n">root</span><span class="p">;</span>          <span class="cm">/* use root table entries */</span>
<a name="line-208"></a>    <span class="n">mask</span> <span class="o">=</span> <span class="n">used</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>            <span class="cm">/* mask for comparing low */</span>
<a name="line-209"></a>
<a name="line-210"></a>    <span class="cm">/* check available table space */</span>
<a name="line-211"></a>    <span class="k">if</span> <span class="p">((</span><span class="n">type</span> <span class="o">==</span> <span class="n">LENS</span> <span class="o">&amp;&amp;</span> <span class="n">used</span> <span class="o">&gt;=</span> <span class="n">ENOUGH_LENS</span><span class="p">)</span> <span class="o">||</span>
<a name="line-212"></a>        <span class="p">(</span><span class="n">type</span> <span class="o">==</span> <span class="n">DISTS</span> <span class="o">&amp;&amp;</span> <span class="n">used</span> <span class="o">&gt;=</span> <span class="n">ENOUGH_DISTS</span><span class="p">))</span>
<a name="line-213"></a>        <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
<a name="line-214"></a>
<a name="line-215"></a>    <span class="cm">/* process all codes and make table entries */</span>
<a name="line-216"></a>    <span class="k">for</span> <span class="p">(;;)</span> <span class="p">{</span>
<a name="line-217"></a>        <span class="cm">/* create table entry */</span>
<a name="line-218"></a>        <span class="n">here</span><span class="p">.</span><span class="n">bits</span> <span class="o">=</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">char</span><span class="p">)(</span><span class="n">len</span> <span class="o">-</span> <span class="n">drop</span><span class="p">);</span>
<a name="line-219"></a>        <span class="k">if</span> <span class="p">((</span><span class="kt">int</span><span class="p">)(</span><span class="n">work</span><span class="p">[</span><span class="n">sym</span><span class="p">])</span> <span class="o">&lt;</span> <span class="n">end</span><span class="p">)</span> <span class="p">{</span>
<a name="line-220"></a>            <span class="n">here</span><span class="p">.</span><span class="n">op</span> <span class="o">=</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">char</span><span class="p">)</span><span class="mi">0</span><span class="p">;</span>
<a name="line-221"></a>            <span class="n">here</span><span class="p">.</span><span class="n">val</span> <span class="o">=</span> <span class="n">work</span><span class="p">[</span><span class="n">sym</span><span class="p">];</span>
<a name="line-222"></a>        <span class="p">}</span>
<a name="line-223"></a>        <span class="k">else</span> <span class="k">if</span> <span class="p">((</span><span class="kt">int</span><span class="p">)(</span><span class="n">work</span><span class="p">[</span><span class="n">sym</span><span class="p">])</span> <span class="o">&gt;</span> <span class="n">end</span><span class="p">)</span> <span class="p">{</span>
<a name="line-224"></a>            <span class="n">here</span><span class="p">.</span><span class="n">op</span> <span class="o">=</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">char</span><span class="p">)(</span><span class="n">extra</span><span class="p">[</span><span class="n">work</span><span class="p">[</span><span class="n">sym</span><span class="p">]]);</span>
<a name="line-225"></a>            <span class="n">here</span><span class="p">.</span><span class="n">val</span> <span class="o">=</span> <span class="n">base</span><span class="p">[</span><span class="n">work</span><span class="p">[</span><span class="n">sym</span><span class="p">]];</span>
<a name="line-226"></a>        <span class="p">}</span>
<a name="line-227"></a>        <span class="k">else</span> <span class="p">{</span>
<a name="line-228"></a>            <span class="n">here</span><span class="p">.</span><span class="n">op</span> <span class="o">=</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">char</span><span class="p">)(</span><span class="mi">32</span> <span class="o">+</span> <span class="mi">64</span><span class="p">);</span>         <span class="cm">/* end of block */</span>
<a name="line-229"></a>            <span class="n">here</span><span class="p">.</span><span class="n">val</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<a name="line-230"></a>        <span class="p">}</span>
<a name="line-231"></a>
<a name="line-232"></a>        <span class="cm">/* replicate for those indices with low len bits equal to huff */</span>
<a name="line-233"></a>        <span class="n">incr</span> <span class="o">=</span> <span class="mi">1U</span> <span class="o">&lt;&lt;</span> <span class="p">(</span><span class="n">len</span> <span class="o">-</span> <span class="n">drop</span><span class="p">);</span>
<a name="line-234"></a>        <span class="n">fill</span> <span class="o">=</span> <span class="mi">1U</span> <span class="o">&lt;&lt;</span> <span class="n">curr</span><span class="p">;</span>
<a name="line-235"></a>        <span class="n">min</span> <span class="o">=</span> <span class="n">fill</span><span class="p">;</span>                 <span class="cm">/* save offset to next table */</span>
<a name="line-236"></a>        <span class="k">do</span> <span class="p">{</span>
<a name="line-237"></a>            <span class="n">fill</span> <span class="o">-=</span> <span class="n">incr</span><span class="p">;</span>
<a name="line-238"></a>            <span class="n">next</span><span class="p">[(</span><span class="n">huff</span> <span class="o">&gt;&gt;</span> <span class="n">drop</span><span class="p">)</span> <span class="o">+</span> <span class="n">fill</span><span class="p">]</span> <span class="o">=</span> <span class="n">here</span><span class="p">;</span>
<a name="line-239"></a>        <span class="p">}</span> <span class="k">while</span> <span class="p">(</span><span class="n">fill</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">);</span>
<a name="line-240"></a>
<a name="line-241"></a>        <span class="cm">/* backwards increment the len-bit code huff */</span>
<a name="line-242"></a>        <span class="n">incr</span> <span class="o">=</span> <span class="mi">1U</span> <span class="o">&lt;&lt;</span> <span class="p">(</span><span class="n">len</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>
<a name="line-243"></a>        <span class="k">while</span> <span class="p">(</span><span class="n">huff</span> <span class="o">&amp;</span> <span class="n">incr</span><span class="p">)</span>
<a name="line-244"></a>            <span class="n">incr</span> <span class="o">&gt;&gt;=</span> <span class="mi">1</span><span class="p">;</span>
<a name="line-245"></a>        <span class="k">if</span> <span class="p">(</span><span class="n">incr</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
<a name="line-246"></a>            <span class="n">huff</span> <span class="o">&amp;=</span> <span class="n">incr</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
<a name="line-247"></a>            <span class="n">huff</span> <span class="o">+=</span> <span class="n">incr</span><span class="p">;</span>
<a name="line-248"></a>        <span class="p">}</span>
<a name="line-249"></a>        <span class="k">else</span>
<a name="line-250"></a>            <span class="n">huff</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<a name="line-251"></a>
<a name="line-252"></a>        <span class="cm">/* go to next symbol, update count, len */</span>
<a name="line-253"></a>        <span class="n">sym</span><span class="o">++</span><span class="p">;</span>
<a name="line-254"></a>        <span class="k">if</span> <span class="p">(</span><span class="o">--</span><span class="p">(</span><span class="n">count</span><span class="p">[</span><span class="n">len</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
<a name="line-255"></a>            <span class="k">if</span> <span class="p">(</span><span class="n">len</span> <span class="o">==</span> <span class="n">max</span><span class="p">)</span> <span class="k">break</span><span class="p">;</span>
<a name="line-256"></a>            <span class="n">len</span> <span class="o">=</span> <span class="n">lens</span><span class="p">[</span><span class="n">work</span><span class="p">[</span><span class="n">sym</span><span class="p">]];</span>
<a name="line-257"></a>        <span class="p">}</span>
<a name="line-258"></a>
<a name="line-259"></a>        <span class="cm">/* create new sub-table if needed */</span>
<a name="line-260"></a>        <span class="k">if</span> <span class="p">(</span><span class="n">len</span> <span class="o">&gt;</span> <span class="n">root</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">huff</span> <span class="o">&amp;</span> <span class="n">mask</span><span class="p">)</span> <span class="o">!=</span> <span class="n">low</span><span class="p">)</span> <span class="p">{</span>
<a name="line-261"></a>            <span class="cm">/* if first time, transition to sub-tables */</span>
<a name="line-262"></a>            <span class="k">if</span> <span class="p">(</span><span class="n">drop</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
<a name="line-263"></a>                <span class="n">drop</span> <span class="o">=</span> <span class="n">root</span><span class="p">;</span>
<a name="line-264"></a>
<a name="line-265"></a>            <span class="cm">/* increment past last table */</span>
<a name="line-266"></a>            <span class="n">next</span> <span class="o">+=</span> <span class="n">min</span><span class="p">;</span>            <span class="cm">/* here min is 1 &lt;&lt; curr */</span>
<a name="line-267"></a>
<a name="line-268"></a>            <span class="cm">/* determine length of next table */</span>
<a name="line-269"></a>            <span class="n">curr</span> <span class="o">=</span> <span class="n">len</span> <span class="o">-</span> <span class="n">drop</span><span class="p">;</span>
<a name="line-270"></a>            <span class="n">left</span> <span class="o">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">curr</span><span class="p">);</span>
<a name="line-271"></a>            <span class="k">while</span> <span class="p">(</span><span class="n">curr</span> <span class="o">+</span> <span class="n">drop</span> <span class="o">&lt;</span> <span class="n">max</span><span class="p">)</span> <span class="p">{</span>
<a name="line-272"></a>                <span class="n">left</span> <span class="o">-=</span> <span class="n">count</span><span class="p">[</span><span class="n">curr</span> <span class="o">+</span> <span class="n">drop</span><span class="p">];</span>
<a name="line-273"></a>                <span class="k">if</span> <span class="p">(</span><span class="n">left</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="k">break</span><span class="p">;</span>
<a name="line-274"></a>                <span class="n">curr</span><span class="o">++</span><span class="p">;</span>
<a name="line-275"></a>                <span class="n">left</span> <span class="o">&lt;&lt;=</span> <span class="mi">1</span><span class="p">;</span>
<a name="line-276"></a>            <span class="p">}</span>
<a name="line-277"></a>
<a name="line-278"></a>            <span class="cm">/* check for enough space */</span>
<a name="line-279"></a>            <span class="n">used</span> <span class="o">+=</span> <span class="mi">1U</span> <span class="o">&lt;&lt;</span> <span class="n">curr</span><span class="p">;</span>
<a name="line-280"></a>            <span class="k">if</span> <span class="p">((</span><span class="n">type</span> <span class="o">==</span> <span class="n">LENS</span> <span class="o">&amp;&amp;</span> <span class="n">used</span> <span class="o">&gt;=</span> <span class="n">ENOUGH_LENS</span><span class="p">)</span> <span class="o">||</span>
<a name="line-281"></a>                <span class="p">(</span><span class="n">type</span> <span class="o">==</span> <span class="n">DISTS</span> <span class="o">&amp;&amp;</span> <span class="n">used</span> <span class="o">&gt;=</span> <span class="n">ENOUGH_DISTS</span><span class="p">))</span>
<a name="line-282"></a>                <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
<a name="line-283"></a>
<a name="line-284"></a>            <span class="cm">/* point entry in root table to sub-table */</span>
<a name="line-285"></a>            <span class="n">low</span> <span class="o">=</span> <span class="n">huff</span> <span class="o">&amp;</span> <span class="n">mask</span><span class="p">;</span>
<a name="line-286"></a>            <span class="p">(</span><span class="o">*</span><span class="n">table</span><span class="p">)[</span><span class="n">low</span><span class="p">].</span><span class="n">op</span> <span class="o">=</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">char</span><span class="p">)</span><span class="n">curr</span><span class="p">;</span>
<a name="line-287"></a>            <span class="p">(</span><span class="o">*</span><span class="n">table</span><span class="p">)[</span><span class="n">low</span><span class="p">].</span><span class="n">bits</span> <span class="o">=</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">char</span><span class="p">)</span><span class="n">root</span><span class="p">;</span>
<a name="line-288"></a>            <span class="p">(</span><span class="o">*</span><span class="n">table</span><span class="p">)[</span><span class="n">low</span><span class="p">].</span><span class="n">val</span> <span class="o">=</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">short</span><span class="p">)(</span><span class="n">next</span> <span class="o">-</span> <span class="o">*</span><span class="n">table</span><span class="p">);</span>
<a name="line-289"></a>        <span class="p">}</span>
<a name="line-290"></a>    <span class="p">}</span>
<a name="line-291"></a>
<a name="line-292"></a>    <span class="cm">/* fill in remaining table entry if code is incomplete (guaranteed to have</span>
<a name="line-293"></a><span class="cm">       at most one remaining entry, since if the code is incomplete, the</span>
<a name="line-294"></a><span class="cm">       maximum code length that was allowed to get this far is one bit) */</span>
<a name="line-295"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">huff</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
<a name="line-296"></a>        <span class="n">here</span><span class="p">.</span><span class="n">op</span> <span class="o">=</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">char</span><span class="p">)</span><span class="mi">64</span><span class="p">;</span>            <span class="cm">/* invalid code marker */</span>
<a name="line-297"></a>        <span class="n">here</span><span class="p">.</span><span class="n">bits</span> <span class="o">=</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">char</span><span class="p">)(</span><span class="n">len</span> <span class="o">-</span> <span class="n">drop</span><span class="p">);</span>
<a name="line-298"></a>        <span class="n">here</span><span class="p">.</span><span class="n">val</span> <span class="o">=</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">short</span><span class="p">)</span><span class="mi">0</span><span class="p">;</span>
<a name="line-299"></a>        <span class="n">next</span><span class="p">[</span><span class="n">huff</span><span class="p">]</span> <span class="o">=</span> <span class="n">here</span><span class="p">;</span>
<a name="line-300"></a>    <span class="p">}</span>
<a name="line-301"></a>
<a name="line-302"></a>    <span class="cm">/* set return parameters */</span>
<a name="line-303"></a>    <span class="o">*</span><span class="n">table</span> <span class="o">+=</span> <span class="n">used</span><span class="p">;</span>
<a name="line-304"></a>    <span class="o">*</span><span class="n">bits</span> <span class="o">=</span> <span class="n">root</span><span class="p">;</span>
<a name="line-305"></a>    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<a name="line-306"></a><span class="p">}</span>
</pre></div>
</td></tr></table>
      </div>
      <div id="footer">
        <p>
         Cppcheck 1.70 dev - a tool for static C/C++ code analysis</br>
         </br>
         Internet: <a href="http://cppcheck.sourceforge.net">http://cppcheck.sourceforge.net</a></br>
         IRC: <a href="irc://irc.freenode.net/cppcheck">irc://irc.freenode.net/cppcheck</a></br>
        <p>
      </div>
  </body>
</html>
